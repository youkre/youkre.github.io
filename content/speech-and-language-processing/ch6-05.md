---
title: "6.5 TF-IDF：向量中词语的加权"
summary: ""
date: 2025-10-14T09:00:00+08:00
---

上述共现矩阵使用频率来表示每个单元格，无论是词语与文档的共现（图6.5），还是词语与其他词语的共现（图6.6）。但原始频率并不是衡量词语间关联性的最佳指标。原始频率分布高度偏斜且区分能力差。如果想了解“cherry”（樱桃）和“strawberry”（草莓）之间共享了什么样的上下文，但这个上下文又不存在于“digital”（数字）和“information”（信息）之间，那么像“the”、“it”或“they”这类高频词就无法提供良好的区分度，因为它们与各种词语频繁共现，对任何特定词语都缺乏信息量。我们在莎士比亚语料库的图6.3中也看到了这一点；“good”（好）一词的维度在各戏剧之间区分度不高；“good”只是一个高频词，在每部戏剧中都有大致相当的高频率。

这有点矛盾。出现频率较高的邻近词（比如“cherry”附近的“pie”）比仅出现一两次的词更重要。然而，过于频繁的词——如“the”或“good”这类无处不在的词——又不重要。我们如何平衡这两个相互矛盾的约束呢？

解决这个问题有两种常见方法：在本节中，我们将介绍**tf-idf**加权法，通常在维度为文档时使用。在下一节中，我们将介绍**PPMI**算法（通常在维度为词语时使用）。

**tf-idf加权**（此处的“-”是连字符，不是减号）由两项乘积构成，每项体现了上述两种基本思想之一：

第一项是**词频**（term frequency，Luhn, 1957）：词 $t$ 在文档 $d$ 中的频率。我们可以直接使用原始计数作为词频：

$$
tf_{t,d} = \text{count}(t,d)
\tag{6.11}
$$

更常见的是，通过使用频率的以10为底的对数来稍微压缩原始频率。其背后的考虑是，一个词在文档中出现100次，并不意味着它与文档意义相关的可能性是出现1次的100倍。我们还需要对计数为0的情况进行特殊处理，因为无法对0取对数。[^1]

[^1] 也可以使用以下替代公式，我们在早期版本中曾使用过：$tf_{t,d} = \log_{10}(\text{count}(t,d)+ 1)$

$$
tf_{t,d} =
\begin{cases}
1 + \log_{10}\text{count}(t,d) & \text{若 } \text{count}(t,d) > 0 \\
0 & \text{否则}
\end{cases}
\tag{6.12}
$$

如果使用对数加权，那么在文档中出现0次的词项，其 $tf= 0$；出现1次时，$tf = 1 + \log_{10}(1) =1 + 0 = 1$；出现10次时，$tf = 1 + \log_{10}(10) = 2$；出现100次时，$tf = 1 +\log_{10}(100) =3$；出现1000次时，$tf = 4$，依此类推。

tf-idf中的第二项用于给那些仅在少数文档中出现的词赋予更高的权重。仅限于少数文档的词项有助于将这些文档与集合中的其余文档区分开来；而在整个集合中频繁出现的词项则帮助不大。一个词项 $t$ 的**文档频率**（document frequency）$df_t$ 是它出现的文档数量。文档频率与词项的**集合频率**（collection frequency）不同，集合频率是指该词在整个集合所有文档中出现的总次数。以莎士比亚的37部戏剧集合为例，考虑“Romeo”（罗密欧）和“action”（行动）这两个词。它们的集合频率相同（在所有戏剧中都出现了113次），但文档频率却大不相同，因为“Romeo”只出现在一部戏剧中。如果我们的目标是找到关于罗密欧浪漫纠葛的文档，那么“Romeo”一词应被赋予高权重，而“action”则不应：

| | 集合频率 | 文档频率 |
|:---|:---|:---|
| Romeo | 113 | 1 |
| action | 113 | 31 |

我们通过**逆文档频率**（inverse document frequency）或**idf**词项权重（Sparck Jones, 1972）来强调像“Romeo”这样的具有区分性的词。idf使用分数 $N/df_t$ 来定义，其中 $N$ 是集合中文档的总数，$df_t$ 是词项 $t$ 出现的文档数量。一个词项出现的文档越少，这个权重就越高。在所有文档中都出现的词项被赋予最低权重1。通常很清楚什么算作一篇文档：在莎士比亚作品中，我们使用一部戏剧；在处理维基百科等百科全书文章集合时，文档是一篇维基百科页面；在处理报纸文章时，文档是一篇文章。有时你的语料库可能没有合适的文档划分，你可能需要为了计算idf而自己将语料库划分为文档。

由于许多集合中文档数量庞大，这一度量通常也用对数函数进行压缩。因此，逆文档频率（idf）的最终定义为：

$$
idf_t = \log_{10}(\frac{N}{df_t})
\tag{6.13}
$$

以下是一些莎士比亚语料库中某些词的idf值（以及其基础的文档频率 $df$ 值），从仅出现在一部戏剧中、信息量极大的词如“Romeo”，到出现在几部戏剧中的词如“salad”（沙拉）或“Falstaff”（福斯塔夫），再到非常常见如“fool”（傻瓜），以及像“good”（好）或“sweet”（甜）这样在全部37部戏剧中都出现、完全无区分度的常见词。[^2]

[^2] “Sweet”是莎士比亚最喜欢的形容词之一，这一事实可能与16世纪末欧洲食谱中糖的使用增加有关（Jurafsky, 2014, 第175页）。

| 词语 | $df$ | $idf$ |
|:---|:---|:---|
| Romeo | 1 | 1.57 |
| salad | 2 | 1.27 |
| Falstaff | 4 | 0.967 |
| forest | 12 | 0.489 |
| battle | 21 | 0.246 |
| wit | 34 | 0.037 |
| fool | 36 | 0.012 |
| good | 37 | 0 |
| sweet | 37 | 0 |

因此，词 $t$ 在文档 $d$ 中的**tf-idf**加权值 $w_{t,d}$ 结合了词频 $tf_{t,d}$（由公式6.11或6.12定义）和公式6.13的idf：

$$
w_{t,d} = tf_{t,d} \times idf_t
\tag{6.14}
$$

图6.9将tf-idf加权应用于图6.2中的莎士比亚词-文档矩阵，使用的是公式6.12的 $tf$ 计算方法。注意，对应“good”一词的维度的tf-idf值现在都变成了0；由于这个词出现在每一篇文档中，tf-idf加权使其被忽略。同样，“fool”一词在37部戏剧中出现了36部，其权重也大大降低。

tf-idf加权是信息检索中加权共现矩阵的方法，也在自然语言处理的许多其他方面发挥作用。它也是一个极好的基线方法，是首先尝试的简单方法。我们将在第6.6节中探讨其他加权方法，如PPMI（正点互信息）。

| | 皆大欢喜 | 第十二夜 | 凯撒大帝 | 亨利五世 |
| :--- | :--- | :--- | :--- | :--- |
| battle（战斗） | 0.246 | 0 | 0.454 | 0.520 |
| good（好） | 0 | 0 | 0 | 0 |
| fool（傻瓜） | 0.030 | 0.033 | 0.0012 | 0.0019 |
| wit（机智） | 0.085 | 0.081 | 0.048 | 0.054 |

**图6.9** 莎士比亚戏剧中四个词的tf-idf加权词-文档矩阵的一部分，展示了4部戏剧的选段，使用图6.2中的计数数据。例如，“wit”在《皆大欢喜》中的0.085值是 $tf = 1 + \log_{10}(20) = 2.301$ 和 $idf= 0.037$ 的乘积。注意，idf加权消除了无处不在的词“good”的重要性，并极大地降低了几乎无处不在的词“fool”的影响。


<nav class="pagination justify-content-between">
<a href="../ch6-04">6.4 用余弦度量相似性</a>
<a href="../">目录</a>
<a href="../ch6-06">6.6 点互信息（PMI）</a>
</nav>

